<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏示例</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000; /* 背景颜色 */
        }
        canvas {
            display: block;
            margin: 0 auto; /* 居中显示 */
            border: 1px solid black; /* 可选的边框 */
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // 设置画布大小
        const ratio = window.devicePixelRatio || 1;
        canvas.width = 800 * ratio;
        canvas.height = 600 * ratio;
        canvas.style.width = '800px';
        canvas.style.height = '600px';

        // 游戏设置
        const platformY = 550; // 平台高度 (确保和实际场景一致)
        const gravity = 0.5;
        const playerSpeed = 5;

        // 玩家对象
        const player = {
            x: 50,
            y: platformY - 50,
            width: 100,  // 增大玩家宽度
            height: 100, // 增大玩家高度
            vx: 0,
            vy: 0,
            speed: playerSpeed,
            jumping: false
        };

        // 资源加载
        const playerImage = new Image();
        const bulletImage = new Image();
        const background = new Image();
        const monsterImages = {
            move: [],
            stand: [],
            hit: [],
            die: [],
            big: []
        };

        function loadImages() {
            playerImage.src = 'assets/a.png'; // 玩家图片
            bulletImage.src = 'assets/b.png'; // 子弹图片
            background.src = 'assets/bp.png'; // 背景图片

            // 加载怪物图像
            ['move_0.png', 'move_1.png', 'move_2.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.move.push(img);
            });
            ['stand_0.png', 'stand_1.png', 'stand_2.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.stand.push(img);
            });
            ['hit1_0.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.hit.push(img);
            });
            ['die1_0.png', 'die1_1.png', 'die1_2.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.die.push(img);
            });

            // 加载大怪物图像（使用同样的图像，只是放大）
            ['move_0.png', 'move_1.png', 'move_2.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.big.push(img);
            });
            ['stand_0.png', 'stand_1.png', 'stand_2.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.big.push(img);
            });
            ['hit1_0.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.big.push(img);
            });
            ['die1_0.png', 'die1_1.png', 'die1_2.png'].forEach(src => {
                const img = new Image();
                img.src = `assets/${src}`;
                monsterImages.big.push(img);
            });
        }

        // 播放背景音乐
        const backgroundMusic = new Audio('assets/sheshoucun.mp3');
        function playBackgroundMusic() {
            backgroundMusic.loop = true;
            backgroundMusic.play();
        }

        // 更新玩家位置
        function updatePlayer() {
            player.x += player.vx;
            player.y += player.vy;

            // 添加重力
            if (player.y + player.height < platformY) {
                player.vy += gravity;
            } else {
                player.y = platformY - player.height; // 确保玩家在平台上
                player.vy = 0;
                player.jumping = false;
            }

            // 确保玩家不移出画布
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
        }

        // 绘制游戏元素
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 绘制背景
            ctx.drawImage(background, 0, 0, canvas.width, canvas.height);

            // 绘制玩家
            ctx.drawImage(playerImage, player.x, player.y, player.width, player.height);

            // 绘制怪物（假设怪物对象已经存在并且包含位置属性）
            // for (const monster of monsters) {
            //     ctx.drawImage(monster.image, monster.x, monster.y, monster.width, monster.height);
            // }
        }

        // 处理键盘输入
        function handleKeyDown(event) {
            switch (event.code) {
                case 'ArrowLeft':
                    player.vx = -player.speed;
                    break;
                case 'ArrowRight':
                    player.vx = player.speed;
                    break;
                case 'Space':
                    if (!player.jumping) {
                        player.vy = -10; // 跳跃速度
                        player.jumping = true;
                    }
                    break;
            }
        }

        function handleKeyUp(event) {
            switch (event.code) {
                case 'ArrowLeft':
                case 'ArrowRight':
                    player.vx = 0;
                    break;
            }
        }

        window.addEventListener('keydown', handleKeyDown);
        window.addEventListener('keyup', handleKeyUp);

        // 游戏循环
        function gameLoop() {
            updatePlayer();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // 初始化游戏
        function initialize() {
            loadImages();
            playBackgroundMusic();
            // setInterval(() => spawnMonster(false), monsterRespawnTime);
            // setInterval(() => spawnMonster(true), monsterRespawnTime * 2); // 每两倍时间生成大怪物
            gameLoop();
        }

        initialize();
    </script>
</body>
</html>
